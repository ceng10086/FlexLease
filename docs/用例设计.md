# 智能化共享租赁平台用例设计（2025Q4 重构版）

> 本文档基于《项目说明.md》、最新版 README 以及仓库中最新代码（后端微服务与重构后的 Vue 3 前端）整理，旨在为 FlexLease 平台的需求规划、页面开发与测试验证提供统一视角。所有页面路径均对应 `frontend/src/pages/**` 下的实现。

## 1. 系统边界与参与者

| 角色 | 描述 | 主要目标 |
| ---- | ---- | -------- |
| 平台管理员 `ADMIN` | 负责平台运营、风控与审核的后台人员，通过统一工作台左侧「平台管理」菜单操作 | 审核厂商/商品、监控订单与支付、配置通知、执行运营工具 |
| 厂商 `VENDOR` | 在平台提供租赁商品的商户，使用「厂商工作台」菜单 | 完成入驻、维护商品及租赁方案、处理订单履约、关注指标与结算 |
| 消费者 `USER` | 使用平台租赁商品的终端客户，使用「商品目录」「我的订单」「通知中心」菜单 | 浏览商品、创建订单、处理续租/退租/买断、查看通知 |
| 外部系统 | 支付渠道、通知通道、第三方商品供给（规划中） | 为平台提供支付、消息、商品信息等支撑能力 |

## 2. 用例总览

### 2.1 平台管理员

| 编号 | 用例 | 目标 | 前端入口 |
| ---- | ---- | ---- | -------- |
| UC-A01 | 管理员登录 | 获取后台访问权限 | `/login` |
| UC-A02 | 审核厂商入驻 | 激活厂商账号 | `pages/admin/AdminVendorReviewPage.vue` |
| UC-A03 | 审核商品与租赁方案 | 把控商品上线质量 | `pages/admin/AdminProductReviewPage.vue` |
| UC-A04 | 订单监控与详情查看 | 发现异常订单/履约问题并可强制关闭 | `pages/admin/AdminOrderMonitorPage.vue` |
| UC-A05 | 运营工具箱 | 手动触发订单、支付、通知流程，辅助联调 | `pages/admin/AdminOperationsCenterPage.vue` |
| UC-A06 | 查看系统公告 | 了解平台通知动态 | `pages/overview/OverviewPage.vue` 通知卡片 |

### 2.2 厂商（B 端）

| 编号 | 用例 | 目标 | 前端入口 |
| ---- | ---- | ---- | -------- |
| UC-V01 | 厂商注册/登录 | 获取工作台权限 | `/register?role=VENDOR` |
| UC-V02 | 提交/查看入驻申请 | 完成资质审核 | `pages/vendor/VendorOnboardingPage.vue` |
| UC-V03 | 创建与维护商品 | 维护租赁资料与描述 | `pages/vendor/VendorProductWorkspacePage.vue` |
| UC-V04 | 配置租赁方案与 SKU | 定价与库存管理 | 同上（抽屉内操作） |
| UC-V05 | 提交商品审核 | 请求上线审批 | 同上（提交按钮） |
| UC-V06 | 订单履约处理 | 发货、退租审批、买断确认 | `pages/vendor/VendorOrderWorkspacePage.vue` |
| UC-V07 | 查看运营指标 | 关注 GMV、活跃订单、状态分布 | `pages/vendor/VendorAnalyticsPage.vue` |
| UC-V08 | 查看支付结算 | 了解押金/租金/退款净额 | `pages/vendor/VendorSettlementPage.vue` |

### 2.3 消费者（C 端）

| 编号 | 用例 | 目标 | 前端入口 |
| ---- | ---- | ---- | -------- |
| UC-U01 | 注册/登录 | 获取租赁能力 | `/register?role=USER` /
 `/login` |
| UC-U02 | 浏览商品目录 | 查找租赁商品 | `pages/customer/CatalogPage.vue` |
| UC-U03 | 查看商品详情与方案 | 了解租期/押金/库存 | `pages/customer/ProductDetailPage.vue` |
| UC-U04 | 订单试算与创建 | 计算押金租金、生成订单 | `pages/customer/CheckoutPage.vue` |
| UC-U05 | 我的订单列表 | 查看订单状态、跳转详情 | `pages/customer/OrdersPage.vue` |
| UC-U06 | 订单详情操作 | 支付、续租、退租、买断及确认收货 | `pages/customer/OrderDetailPage.vue` |
| UC-U07 | 查看平台通知 | 获取订单与系统消息 | `pages/customer/NotificationCenterPage.vue` |
| UC-U08 | 管理购物车 | 添加/编辑/删除购物车条目并用于下单 | （API 接口，前端页面规划中） |

## 3. 关键用例流程说明

### 3.1 管理员视角

- **UC-A02 审核厂商入驻**
  1. 在「厂商审核」页按状态筛选待审核记录。
  2. 打开详情抽屉查看资质信息。
  3. 通过 `/vendors/applications/{id}/approve` 或 `/reject` 提交审核意见。
  4. 审核结果即时回写列表并触发通知。

- **UC-A03 审核商品与租赁方案**
  1. 「商品审核」按状态、分页浏览待审商品。
  2. 调用 `/vendors/{vendorId}/products/{id}` 获取商品与方案细节。
  3. 审核通过 `/admin/products/{id}/approve` 或驳回 `/reject`，记录备注。

- **UC-A04/UC-A05 订单监控与运营工具**
  - 订单监控调用 `/admin/orders`（支持用户/厂商/状态过滤，无参时返回全量分页），抽屉展示 `fetchOrder` 详情并允许触发强制关闭。
  - 运营工具箱提供 `previewOrder`、`createOrder`、`shipOrder`、`confirmOrderReceive`、`initPayment`、`confirmPayment`、`sendNotification` 及 `forceCloseOrder` 等入口，便于联调与诊断。

### 3.2 厂商视角

- **UC-V02 入驻申请**
  - 填写企业信息后调用 `/vendors/applications`，接口依赖 `X-User-Id` 头部。
  - 页面实时展示最新申请列表与审核状态（`listVendorApplications`）。

- **UC-V03~UC-V05 商品维护全流程**
  1. 新建商品 `/vendors/{vendorId}/products`，形成草稿。
  2. 配置租赁方案 `/rental-plans`、SKU `/skus`，可进行库存调整 `/inventory/adjust`。
  3. 提交审核 `/submit`，状态转为 `PENDING_REVIEW`，等待管理员处理。

- **UC-V06 订单履约**
  - 列表通过 `/orders?vendorId=...` 获取。
  - 发货 `/ship`、退租审批 `/return/approve`、处理买断 `/buyout/confirm` 等操作在抽屉表单中完成。

- **UC-V07/UC-V08 指标与结算**
  - 指标：`/analytics/vendor/{vendorId}` 返回 GMV、活跃订单、状态分布。
  - 结算：`/payments/settlements` 支持按日期过滤押金、租金、净入账。

### 3.3 消费者视角

- **UC-U02 商品浏览**
  - `/catalog/products` 支持关键字搜索与分页，卡片展示租赁方案关键信息。

- **UC-U03 商品详情**
  - `/catalog/products/{id}` 返回租赁方案、SKU 库存，支持选择方案与数量，跳转结算页。

- **UC-U04 订单试算与创建**
  1. 从商品详情携带 `planId/skuId/quantity` 等参数跳转结算页。
  2. 结算页调用 `/orders/preview` 试算费用，确认后 `/orders` 创建订单。

- **UC-U05/UC-U06 订单管理**
  - 列表 `/orders?userId=...` 展示所有订单，支持状态过滤。
  - 详情页调用 `/orders/{id}` 并提供续租 `/extend`、退租 `/return`、买断 `/buyout`、确认收货 `/confirm-receive` 等入口。

- **UC-U07 通知中心**
  - 时间轴呈现 `/notifications/logs`，可按状态过滤（待发送/已发送/失败）。

## 4. 前端页面与后端服务映射

| 路由 | 页面组件 | 核心用例 | 主要 API | 所属微服务 |
| ---- | -------- | -------- | -------- | ---------- |
| `/app/overview` | `pages/overview/OverviewPage.vue` | 平台指标、公告、最近订单 | `/analytics/dashboard`, `/analytics/vendor/{id}`, `/notifications/logs`, `/orders` | `order-service`, `notification-service` |
| `/app/catalog` | `pages/customer/CatalogPage.vue` | 商品浏览 | `/catalog/products` | `product-service` |
| `/app/catalog/:id` | `pages/customer/ProductDetailPage.vue` | 方案选择、跳转结算 | `/catalog/products/{id}` | `product-service` |
| `/app/checkout` | `pages/customer/CheckoutPage.vue` | 订单试算与创建 | `/orders/preview`, `/orders` | `order-service` |
| `/app/orders` | `pages/customer/OrdersPage.vue` | 订单列表 | `/orders` | `order-service` |
| `/app/orders/:id` | `pages/customer/OrderDetailPage.vue` | 订单详情与操作 | `/orders/{id}`, `/orders/{id}/*`, `/payments/{orderId}/init` | `order-service`, `payment-service` |
| `/app/notifications` | `pages/customer/NotificationCenterPage.vue` | 通知查看 | `/notifications/logs` | `notification-service` |
| `/app/vendor/onboarding` | `pages/vendor/VendorOnboardingPage.vue` | 入驻申请 | `/vendors/applications` | `user-service` |
| `/app/vendor/products` | `pages/vendor/VendorProductWorkspacePage.vue` | 商品与方案维护 | `/vendors/{vendorId}/products*` | `product-service` |
| `/app/vendor/orders` | `pages/vendor/VendorOrderWorkspacePage.vue` | 履约处理 | `/orders`、`/orders/{id}/*` | `order-service` |
| `/app/vendor/analytics` | `pages/vendor/VendorAnalyticsPage.vue` | 指标查看 | `/analytics/vendor/{id}` | `order-service` |
| `/app/vendor/settlements` | `pages/vendor/VendorSettlementPage.vue` | 结算查看 | `/payments/settlements` | `payment-service` |
| `/app/admin/vendor-review` | `pages/admin/AdminVendorReviewPage.vue` | 厂商审核 | `/vendors/applications*` | `user-service` |
| `/app/admin/product-review` | `pages/admin/AdminProductReviewPage.vue` | 商品审核 | `/admin/products*`, `/vendors/{vendorId}/products/{id}` | `product-service` |
| `/app/admin/orders` | `pages/admin/AdminOrderMonitorPage.vue` | 订单监控 | `/orders` | `order-service` |
| `/app/admin/operations` | `pages/admin/AdminOperationsCenterPage.vue` | 运营调试工具 | `/orders/*`, `/payments/*`, `/notifications/*` | `order-service`, `payment-service`, `notification-service` |

## 5. 测试与验收建议

1. **自动化测试映射**
   - Playwright：保留 `tests/dashboard.spec.ts` 用于仪表盘渲染，建议新增厂商订单履约、消费者订单详情等脚本。
   - 后端集成测试：继续覆盖商品、订单、支付、通知的端到端流程，为前端联调提供稳定契约。

2. **手工回归路径**
   1. 管理员：登录 → 厂商审核 → 商品审核 → 订单监控 → 运营工具箱调试。
   2. 厂商：注册/登录 → 提交入驻 → 创建商品/租赁方案/SKU → 提交审核 → 处理订单 → 查看指标与结算。
   3. 消费者：注册/登录 → 浏览目录 → 商品详情 → 结算下单 → 订单详情续租/退租操作 → 通知中心确认消息。

3. **后续改进 Backlog**
   - 通知中心支持“标记已读”与关键字搜索。
   - 订单详情对接支付流水生成能力，补齐退款/押金归还提示。
   - 运营工具箱支持保存常用请求模板，降低联调成本。

---

本用例文档会随代码与需求迭代持续更新。若后续新增 API、页面或角色能力，请同步补充对应章节，以保障需求、设计与测试之间的一致性。
