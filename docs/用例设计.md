# 智能化共享租赁平台用例设计（2025Q4 重构版）

> 本文档基于《项目说明.md》、最新版 README 以及仓库中最新代码（后端微服务与重构后的 Vue 3 前端）整理，旨在为 FlexLease 平台的需求规划、页面开发与测试验证提供统一视角。所有页面路径均对应 `frontend/src/pages/**` 下的实现。

## 1. 系统边界与参与者

| 角色 | 描述 | 主要目标 |
| ---- | ---- | -------- |
| 平台管理员 `ADMIN` | 负责平台运营、风控与审核的后台人员，通过统一工作台左侧「平台管理」菜单操作 | 审核厂商/商品、监控订单与支付、配置通知 |
| 厂商 `VENDOR` | 在平台提供租赁商品的商户，使用「厂商工作台」菜单 | 完成入驻、维护商品及租赁方案、处理订单履约、关注指标与结算 |
| 消费者 `USER` | 使用平台租赁商品的终端客户，使用「商品目录」「我的订单」「通知中心」菜单 | 浏览商品、创建订单、处理续租/退租/买断、查看通知 |
| 外部系统 | 模拟支付通道、通知服务等基础设施 | 为平台提供支付与消息支撑，不对接外部商品目录 |

## 2. 用例总览

### 2.1 平台管理员

| 编号 | 用例 | 目标 | 前端入口 |
| ---- | ---- | ---- | -------- |
| UC-A01 | 管理员登录 | 获取后台访问权限 | `/login` |
| UC-A02 | 审核厂商入驻 | 激活厂商账号 | `pages/admin/AdminVendorReviewPage.vue` |
| UC-A03 | 审核商品与租赁方案 | 把控商品上线质量 | `pages/admin/AdminProductReviewPage.vue` |
| UC-A04 | 订单监控与详情查看 | 发现异常订单/履约问题并可强制关闭 | `pages/admin/AdminOrderMonitorPage.vue` |
| UC-A05 | 查看平台仪表盘与公告 | 监控 GMV/订单及公告动态 | `pages/overview/OverviewPage.vue` |

### 2.2 厂商（B 端）

| 编号 | 用例 | 目标 | 前端入口 |
| ---- | ---- | ---- | -------- |
| UC-V01 | 厂商注册/登录 | 获取工作台权限 | `/register?role=VENDOR` |
| UC-V02 | 提交/查看入驻申请 | 完成资质审核 | `pages/vendor/VendorOnboardingPage.vue` |
| UC-V03 | 创建与维护商品 | 维护租赁资料与描述 | `pages/vendor/VendorProductWorkspacePage.vue` |
| UC-V04 | 配置租赁方案与 SKU | 定价与库存管理 | 同上（抽屉内操作） |
| UC-V05 | 提交商品审核 | 请求上线审批 | 同上（提交按钮） |
| UC-V06 | 订单履约处理 | 发货、退租审批、买断确认 | `pages/vendor/VendorOrderWorkspacePage.vue` |
| UC-V07 | 查看运营指标 | 关注 GMV、活跃订单、状态分布 | `pages/vendor/VendorAnalyticsPage.vue` |
| UC-V08 | 查看支付结算 | 了解押金/租金/退款净额 | `pages/vendor/VendorSettlementPage.vue` |
| UC-V09 | 上传凭证与订单沟通 | 在发货/退租/巡检场景上传凭证并与用户沟通 | 同上（抽屉内操作） |
| UC-V10 | 纠纷响应与仲裁配合 | 处理用户纠纷、升级仲裁、提交证据 | `pages/vendor/VendorOrderWorkspacePage.vue` |
| UC-V11 | 满意度调研反馈 | 在纠纷结束后填写满意度问卷 | `pages/vendor/VendorOrderWorkspacePage.vue`（调查弹窗） |
| UC-V12 | 商品咨询收发 | 在工作台内查看 72 小时有效的咨询并回复 | `pages/vendor/VendorProductWorkspacePage.vue` |

### 2.3 消费者（C 端）

| 编号 | 用例 | 目标 | 前端入口 |
| ---- | ---- | ---- | -------- |
| UC-U01 | 注册/登录 | 获取租赁能力 | `/register?role=USER` /
 `/login` |
| UC-U02 | 浏览商品目录 | 查找租赁商品 | `pages/customer/CatalogPage.vue` |
| UC-U03 | 查看商品详情与方案 | 了解租期/押金/库存 | `pages/customer/ProductDetailPage.vue` |
| UC-U04 | 订单试算与创建 | 计算押金租金、生成订单 | `pages/customer/CheckoutPage.vue` |
| UC-U05 | 我的订单列表 | 查看订单状态、跳转详情 | `pages/customer/OrdersPage.vue` |
| UC-U06 | 订单详情操作 | 支付、续租、退租、买断及确认收货 | `pages/customer/OrderDetailPage.vue` |
| UC-U07 | 查看平台通知 | 获取订单与系统消息 | `pages/customer/NotificationCenterPage.vue` |
| UC-U08 | 管理购物车 | 添加/编辑/删除购物车条目并用于下单 | `pages/customer/CartPage.vue` |
| UC-U09 | 查看/签署电子合同 | 下载草稿、在线签署 | `pages/customer/OrderDetailPage.vue`（合同抽屉） |
| UC-U10 | 上传取证、订单沟通 | 发货/收货/退租阶段上传照片/视频并留言 | `pages/customer/OrderDetailPage.vue` |
| UC-U11 | 发起并跟进纠纷 | 预设方案协商、升级平台仲裁、申诉 | `pages/customer/OrderDetailPage.vue` |
| UC-U12 | 满意度调研 | 提交评分与反馈 | `pages/customer/OrderDetailPage.vue`（调查弹窗） |
| UC-U13 | 下单前咨询 | 将租赁场景、交付期望在下单前同步给厂商 | `pages/customer/ProductDetailPage.vue` |

## 3. 关键用例流程说明

### 3.1 管理员视角

- **UC-A02 审核厂商入驻**
  1. 在「厂商审核」页按状态筛选待审核记录。
  2. 打开详情抽屉查看资质信息。
  3. 通过 `/vendors/applications/{id}/approve` 或 `/reject` 提交审核意见。
  4. 审核结果即时回写列表并触发通知。

- **UC-A03 审核商品与租赁方案**
  1. 「商品审核」按状态、分页浏览待审商品。
  2. 调用 `/vendors/{vendorId}/products/{id}` 获取商品与方案细节。
  3. 审核通过 `/admin/products/{id}/approve` 或驳回 `/reject`，记录备注。

- **UC-A04 订单监控与强制干预**
  - 订单监控调用 `/admin/orders`（支持用户/厂商/状态过滤，无参时返回全量分页），抽屉展示 `fetchOrder` 详情并允许触发强制关闭。
  - 支付、通知等后台联调能力现由自动模拟完成，管理员无需再手动触发运营工具。

- **UC-A05 仪表盘与公告**
  - Overview 页会同时拉取 `/analytics/dashboard`、`/notifications/logs`（管理员默认看到全局 Top 50）以及 `/orders` 最近订单列表，卡片展示 GMV、活跃订单、租赁模式构成与待办入口。
  - 支持直接跳转至厂商指标（如果账号兼任厂商）或通知中心，便于发现异常订单后快速联动。

### 3.2 厂商视角

- **UC-V02 入驻申请**
  - 登录厂商账号后填写企业信息，提交 `/vendors/applications`；若上一轮被驳回，可在原记录上补充资料后重新提交。
  - 页面会展示最新申请的状态、审核备注与时间信息，方便对照管理员的处理结果。
  - 管理员批准后，用户服务会调用认证中心内部接口为厂商账号绑定 `vendorId`，前端通过 `/auth/me` 拿到该字段并展示厂商工作台。

- **UC-V03~UC-V05 商品维护全流程**
  1. 新建商品 `/vendors/{vendorId}/products`，形成草稿。
  2. 配置租赁方案 `/rental-plans`、SKU `/skus`，可进行库存调整 `/inventory/adjust`。
  3. 提交审核 `/submit`，状态转为 `PENDING_REVIEW`，等待管理员处理。

- **UC-V06 订单履约**
  - 列表通过 `/orders?vendorId=...` 获取，可结合状态过滤查看待处理订单。
  - 抽屉内嵌发货表单（承运方、运单号）、退租/续租/买断审批表单与电子合同抽屉，所有动作会写入订单时间线并触发通知。
- **UC-V09/UC-V10 订单沟通、取证与纠纷**
  - 发货前在抽屉直接上传 `SHIPMENT` 类型的照片/视频，页面实时读取 `/proof-policy` 反馈的最小数量与拍摄角度，上传完成后由 `ProofStorageService` 自动打上“订单号 + 时间”水印；用户上传收货/退租凭证时，厂商可实时查看并以 `/orders/{id}/messages` 回复。
  - 当用户发起纠纷时，厂商在抽屉中即时收到提醒，可选择预设方案、添加备注、随时升级平台仲裁或提供补充凭证；平台裁决后系统会自动触发满意度调查。
- **UC-V11 满意度调研**
  - 纠纷结案或系统安排回访后，厂商会收到调查弹窗/通知，完成评价后时间线追加 “SURVEY_SUBMITTED”，便于后续复盘。
- **UC-V12 商品咨询**
  - `ProductDetailPage` 触发的咨询会通过 `/vendors/{vendorId}/inquiries` 汇总到工作台抽屉，列表展示联系方式、过期时间与回复状态。
  - 厂商在抽屉中填写 `reply` 调用 `/vendors/{vendorId}/inquiries/{id}/reply` 后会立即向消费者推送站内信，逾期未处理的咨询会自动标记为 `EXPIRED`。

- **UC-V07/UC-V08 指标与结算**
  - 指标：`/analytics/vendor/{vendorId}` 返回 GMV、活跃订单、状态分布、7 日趋势以及租赁模式构成，并在顶部补充行业基准/当前抽成/信用档位的卡片，提示厂商当前佣金来源；页面使用 `useVendorContext` 读取登录态中的 `vendorId`，如未携带需退出并重新登录。
  - 结算：`/payments/settlements` 支持按日期过滤押金、租金、买断、退款与净入账，厂商角色仅能查看自身数据，管理员可切换任意 `vendorId`。

### 3.3 消费者视角

- **UC-U02 商品浏览**
  - `/catalog/products` 支持关键字/分类过滤与分页，仅展示状态为 `ACTIVE` 的商品，卡片同步展示租赁方案、押金与库存摘要。

- **UC-U03 商品详情**
  - `/catalog/products/{id}` 返回租赁方案、SKU 库存，支持选择方案与数量，跳转结算页。
- **UC-U13 下单前咨询**
  - 登录用户在 `ProductDetailPage` 的“下单前咨询”表单中填写称呼/联系方式/问题，调用 `/catalog/products/{productId}/inquiries` 后即可在通知中心看到提交成功提示。
  - 咨询有效期默认 72 小时，状态会在消费者端同步展示；厂商回复后会通过同一页面的提示与站内信进行提醒。

- **UC-U04 订单试算与创建**
  1. 从商品详情携带 `planId/skuId/quantity` 等参数跳转结算页。
  2. 结算页调用 `/orders/preview` 试算费用，确认后 `/orders` 创建订单。
  3. 前端会调用 `autoCompleteInitialPayment` 生成 `/payments/{orderId}/init` 请求并（在默认配置下）由后台自动确认支付；若自动支付失败可在订单详情重新生成支付单，超时未支付的订单会被调度器自动取消并释放库存。

- **UC-U05/UC-U06 订单管理**
  - 列表 `/orders?userId=...` 展示所有订单，支持状态过滤。
  - 详情页调用 `/orders/{id}` 并提供续租 `/extend`、退租 `/return`、买断 `/buyout`、确认收货 `/confirm-receive` 等入口，同时展示操作时间线与物流信息。
  - 支付入口仍调用 `/payments/{orderId}/init`，可生成新的支付流水或查看 `paymentTransactionId`，并支持在拖延支付情况下收到通知提醒。
- **信用激励与提醒**
  - `UserProfileController` 会在资料补全后自动上报 `KYC_VERIFIED` 事件获得 +10 分；订单服务在支付/退租/纠纷阶段依次触发 `ON_TIME_PAYMENT`（+5）、`EARLY_RETURN`（+8）、`LATE_PAYMENT`（-8）、`FRIENDLY_DISPUTE`（+3）等事件。
  - `/api/v1/internal/users/{id}/credit-events` 调整后会即时推送站内信，提醒用户押金减免、自动仲裁倒计时等状态。
- **UC-U08 购物车管理**
  - 通过 `/cart` 拉取当前用户的所有条目，页面提供数量调整、删除、清空与批量勾选功能。
  - 由于后台仅允许同一厂商的条目一起下单，前端在触发“生成订单”前会提示并只提交同厂商的 `cartItemIds`，同时实时展示押金/租金汇总。
- **UC-U10/UC-U11 取证与纠纷**
  - 在发货/收货/退租节点上传 `RECEIVE/RETURN` 等类型的取证资料（支持多张照片/视频），前端会调用 `/proof-policy` 显示所需数量与角度，并在上传后展示自动生成的水印示例；若未满足配置的数量限制会阻塞收货/退租完成操作。
  - `OrderDetailPage` 的“沟通/纠纷”卡片允许用户随时留言、选择预设方案发起纠纷、接受/拒绝商家方案、升级平台仲裁或发起申诉，所有动作写入时间线并生成站内信。
- **UC-U12 满意度调研**
  - 纠纷结案后系统会延迟触发满意度调查邀请，用户在弹窗中给出 1~5 分评分与评价，提交后自动推送感谢通知并可在时间线查看记录。

- **UC-U09 合同查看与签署**
  - 首次进入详情时调用 `/orders/{id}/contract` 自动生成电子合同草稿，前端通过 `OrderContractDrawer` 抽屉展示内容，可反复刷新确保与订单同步。
  - 消费者提交 `/orders/{id}/contract/sign` 并附 `signature` 字符串即可完成签署；合同状态回写在 `OrderContractResponse.status`。

- **UC-U07 通知中心**
  - 通过 `/notifications/logs` 拉取最近 50 条记录，并在前端提供状态/渠道筛选、关键字搜索及“按状态统计”/“按渠道统计”卡片，方便定位异常通知。

## 4. 前端页面与后端服务映射

| 路由 | 页面组件 | 核心用例 | 主要 API | 所属微服务 |
| ---- | -------- | -------- | -------- | ---------- |
| `/app/overview` | `pages/overview/OverviewPage.vue` | 平台指标、7 日趋势/租赁模式构成、公告、最近订单 | `/analytics/dashboard`, `/analytics/vendor/{id}`, `/notifications/logs`, `/orders` | `order-service`, `notification-service` |
| `/app/catalog` | `pages/customer/CatalogPage.vue` | 商品浏览 | `/catalog/products` | `product-service` |
| `/app/catalog/:id` | `pages/customer/ProductDetailPage.vue` | 方案选择、跳转结算、下单前咨询 | `/catalog/products/{id}`, `/catalog/products/{id}/inquiries` | `product-service` |
| `/app/checkout` | `pages/customer/CheckoutPage.vue` | 订单试算与创建 | `/orders/preview`, `/orders` | `order-service` |
| `/app/orders` | `pages/customer/OrdersPage.vue` | 订单列表 | `/orders` | `order-service` |
| `/app/orders/:id` | `pages/customer/OrderDetailPage.vue` | 订单详情与操作 | `/orders/{id}`, `/orders/{id}/*`, `/payments/{orderId}/init` | `order-service`, `payment-service` |
| `/app/orders/:id`（合同） | 同上 | 电子合同查看/签署 | `/orders/{id}/contract`, `/orders/{id}/contract/sign` | `order-service` |
| `/app/notifications` | `pages/customer/NotificationCenterPage.vue` | 通知查看 | `/notifications/logs` | `notification-service` |
| `/app/vendor/onboarding` | `pages/vendor/VendorOnboardingPage.vue` | 入驻申请 | `/vendors/applications` | `user-service` |
| `/app/vendor/products` | `pages/vendor/VendorProductWorkspacePage.vue` | 商品与方案维护、咨询管理 | `/vendors/{vendorId}/products*`, `/vendors/{vendorId}/inquiries*` | `product-service` |
| `/app/vendor/orders` | `pages/vendor/VendorOrderWorkspacePage.vue` | 履约处理 | `/orders`、`/orders/{id}/*` | `order-service` |
| `/app/vendor/analytics` | `pages/vendor/VendorAnalyticsPage.vue` | 指标查看 | `/analytics/vendor/{id}` | `order-service` |
| `/app/vendor/settlements` | `pages/vendor/VendorSettlementPage.vue` | 结算查看 | `/payments/settlements` | `payment-service` |
| `/app/admin/vendor-review` | `pages/admin/AdminVendorReviewPage.vue` | 厂商审核 | `/vendors/applications*` | `user-service` |
| `/app/admin/product-review` | `pages/admin/AdminProductReviewPage.vue` | 商品审核 | `/admin/products*`, `/vendors/{vendorId}/products/{id}` | `product-service` |
| `/app/admin/orders` | `pages/admin/AdminOrderMonitorPage.vue` | 订单监控 | `/orders` | `order-service` |

## 5. 测试与验收建议

1. **自动化测试映射**
   - Playwright：保留 `tests/dashboard.spec.ts` 用于仪表盘渲染，建议新增厂商订单履约、消费者订单详情等脚本。
   - 后端集成测试：继续覆盖商品、订单、支付、通知的端到端流程，为前端联调提供稳定契约。

2. **手工回归路径**
   1. 管理员：登录 → 厂商审核 → 商品审核 → 订单监控（支付模拟自动完成，无需运营工具）。
   2. 厂商：注册/登录 → 提交入驻 → 创建商品/租赁方案/SKU → 提交审核 → 处理订单与商品咨询 → 查看指标与结算。
   3. 消费者：注册/登录 → 浏览目录 → 商品详情 → 提交/查看“下单前咨询” → 结算下单 → 订单详情续租/退租（含凭证指引）→ 通知中心确认消息。

3. **后续改进 Backlog**
   - 通知中心支持“标记已读”与关键字搜索。
   - 订单详情对接支付流水生成能力，补齐退款/押金归还提示。
   - 自动支付模拟支持自定义延迟/失败策略，用于联调异常场景。

---

本用例文档会随代码与需求迭代持续更新。若后续新增 API、页面或角色能力，请同步补充对应章节，以保障需求、设计与测试之间的一致性。
