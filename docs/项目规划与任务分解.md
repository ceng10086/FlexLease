# 智能化共享租赁平台项目规划与任务分解

## 1. 项目愿景与范围
- **愿景**：为 B 端厂商与 C 端消费者提供一个覆盖商品展示、租赁、支付、订单全生命周期的共享租赁平台。
- **核心范围**：面向 B2C 模式，支持普通租赁、先租后买、以租代售三类业务流程，覆盖账号/权限、商品、订单、支付、运营管理模块。
- **不在范围**：跨境物流、复杂风控评分、大数据推荐算法、真实支付通道对接（以模拟服务或沙箱代替）。

## 2. 关键角色与诉求
| 角色 | 诉求 | 主要功能 |
| ---- | ---- | -------- |
| 平台管理员 | 运营管理、风控、财务对账 | 用户与角色管理、厂商审核、订单监控、财务统计 |
| 厂商（B 端） | 发布商品、管理订单与库存 | 商品管理、租赁方案配置、订单处理、账单查看 |
| 消费者（C 端） | 便捷租赁、续租、退租、先租后买 | 商品浏览、下单、支付、续租、退租、订单查询 |

## 3. 功能结构分解
```
智能共享租赁平台
├─ 账号与权限中心
│  ├─ 用户注册/登录（B/C/Admin）
│  ├─ 多角色授权与菜单控制
│  └─ 审核及合规流程
├─ 商品与租赁方案管理
│  ├─ 厂商资料与资质
│  ├─ 商品基本信息、库存、图片
│  ├─ 租期/押金/租金方案配置（多模式）
│  └─ 商品上下架与审核
├─ 订单与租赁履约
│  ├─ 下单（普通/先租后买/以租代售）
│  ├─ 订单状态流转（待支付→待发货→履约→归还/买断）
│  ├─ 续租、退租、买断流程
│  └─ 售后（退款、异常处理）
├─ 支付与结算
│  ├─ 模拟支付/对接银行沙箱
│  ├─ 账务拆分（押金/租金/违约金）
│  └─ 财务对账与流水查询
├─ 数据看板与通知
│  ├─ 运营指标（租赁率、续租率、GMV）
│  ├─ 通知与消息（邮件、站内信）
│  └─ 日志审计
└─ 支撑能力
   ├─ 文件存储（商品图片、合同）
   ├─ 消息队列（订单事件、通知推送）
   └─ 定时任务（续租提醒、到期处理）
```

## 4. 技术方案概览
- **后端**：Java 21 + Spring Boot 3.x，Spring Cloud Alibaba（Nacos、Gateway、Sentinel）或 Spring Cloud Netflix 精简组合；JPA/MyBatis-Plus；Redis 缓存。
- **前端**：Vue 3 + Vite + TypeScript；Pinia 状态管理；Ant Design Vue 组件库。
- **数据库**：PostgreSQL 16（主事务库）+ Redis（缓存/会话）。
- **消息队列**：RocketMQ 或 RabbitMQ（视可用性，可在本地用嵌入式/内存实现）。
- **部署形态**：Docker Compose（多容器模拟生产）；开发阶段使用本地多模块 Spring Boot。
- **认证**：JWT + OAuth2 Password/Client Credentials，基于 Spring Authorization Server。

## 5. 微服务拆分
| 服务 | 职责 | 对应数据库 schema |
| ---- | ---- | ------------------ |
| auth-service | 统一认证、授权、组织架构 | auth |
| user-service | 用户基础信息、厂商审核 | user |
| product-service | 商品、库存、租赁方案 | product |
| order-service | 订单主流程、续租退租 | order |
| payment-service | 支付流水、结算对账 | payment |
| billing-service（可选） | 收益分账、报表 | billing |
| notification-service | 消息推送、提醒 | notification |
| gateway-service | API 网关与统一鉴权 | 无（配置） |
| web-frontend | 前端 SPA | 无 |

> 为保持 KISS，可在初版中将 `billing-service` 合并入 `payment-service`，`notification-service` 采用简化实现（数据库轮询+邮件/短信占位）。

## 6. 迭代计划
| 迭代 | 周期 | 目标 | 关键交付 |
| ---- | ---- | ---- | -------- |
| Iteration 0 | 2 天 | 环境搭建、框架脚手架、需求确认 | 项目骨架、CI 工作流草稿、数据库初版 |
| Iteration 1 | 5 天 | 账号与权限、厂商入驻 | Auth 微服务、用户/厂商 API、基础前端登录/后台框架 |
| Iteration 2 | 5 天 | 商品与租赁方案 | 商品 CRUD、租赁配置、库存管理、前端商品管理页 |
| Iteration 3 | 6 天 | 订单与租赁流程 | 下单、履约状态流转、续租/退租逻辑、订单前端页面 |
| Iteration 4 | 4 天 | 支付与结算、对账 | 支付接口、押金/租金账务、结算报表 |
| Iteration 5 | 3 天 | 运营看板、通知、测试与文档 | 报表接口、通知机制、自动化测试、部署脚本 |

## 7. 任务清单（Backlog）
- 需求
  - 用户故事撰写与优先级排序
  - 用例与流程图输出
- 架构与基础设施
  - Spring Cloud 多模块项目初始化
  - 数据库建模与迁移脚本
  - API 网关与服务注册
- 功能
  - 认证授权 + RBAC 菜单
  - 厂商入驻流程（提交→审核→启用）
  - 商品 CRUD、租赁方案配置
  - 购物车/下单、库存锁定
  - 支付（押金/租金）、退款、续租
  - 订单履约任务（定时）
  - 通知服务（邮件/短信占位）
  - 运营仪表盘（基础指标）
- 测试
  - 单元测试（JUnit 5）
  - 集成测试（Spring Boot Test、Testcontainers）
  - 前端 E2E（Playwright）
- DevOps
  - Docker Compose 脚本
  - GitHub Actions CI（构建+测试）
  - SonarLint/Checkstyle 规则

## 8. 风险与缓解
| 风险 | 描述 | 缓解措施 |
| ---- | ---- | -------- |
| 业务复杂度膨胀 | 多模式租赁流程易复杂 | 先实现核心流程，复杂分支延后迭代 |
| 支付对接阻塞 | 实际支付渠道对接困难 | 使用模拟支付服务+沙箱 API |
| 微服务过度拆分 | 服务过多导致负担 | 优先单体内分包，后续再拆分部署 |
| 数据一致性 | 跨服务事务、库存冻结 | 采用事务消息或补偿机制，初版使用本地事务+状态机 |
| 性能瓶颈 | 高并发库存扣减 | 引入 Redis + Lua/乐观锁，初期提供串行实现 |

## 9. 后续文档产出指引
- 《数据库设计》：表结构、索引、ER 模型
- 《API 设计》：接口路径、请求/响应、鉴权方式
- 《测试策略》：测试金字塔、关键用例
- 《部署与运维指南》：环境依赖、配置模板、监控指标

> 当前文档定位为实施指南，后续编码阶段将以此为依据分模块推进。
